name: Docker Image CI

on: push

jobs:

  linux:
    name : Generate for Linux
    runs-on: ubuntu-latest
    if: ${{ github.ref == 'master' }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Build and push Docker images
      uses: docker/build-push-action@v1
      with:
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
          registry: docker.pkg.github.com
          repository: yadoms/docker/build_for_linux
          tag_with_ref: true
          path: build-linux

  rpi:
    name : Generate for RaspberryPI
    if: ${{ github.ref == 'master' }}
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Build and push Docker images
      uses: docker/build-push-action@v1
      with:
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
          registry: docker.pkg.github.com
          repository: yadoms/docker/build_for_raspberrypi
          tag_with_ref: true
          path: build-raspberrypi

  rpiImage:
    name : Generate for RaspberryPI Image
    runs-on: ubuntu-latest
    if: ${{ github.ref == 'master' }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Build and push Docker images
      uses: docker/build-push-action@v1
      with:
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
          registry: docker.pkg.github.com
          repository: yadoms/docker/build-raspberrypi-image
          tag_with_ref: true
          path: build-raspberrypi-image

  rpi10:
    name : Generate for RaspberryPI with GCC10
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Build and push Docker images
      uses: docker/build-push-action@v1
      with:
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
          registry: docker.pkg.github.com
          repository: yadoms/docker/build_for_raspberrypi-gcc10
          tag_with_ref: true
          path: build-raspberrypi-gcc10


  macos:
    name : Generate image for MacOSX (cross compile)
    runs-on: ubuntu-latest
    if: ${{ github.ref == 'master' }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Build and push Docker images
      uses: docker/build-push-action@v1
      with:
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
          registry: docker.pkg.github.com
          repository: yadoms/docker/build_for_macos
          tag_with_ref: true
          path: build-macos
        
        
  Syno212j:
    name : Generate for Synology 212j
    runs-on: ubuntu-latest
    if: ${{ github.ref == 'master' }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Build and push Docker images
      uses: docker/build-push-action@v1
      with:
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
          registry: docker.pkg.github.com
          repository: yadoms/docker/build_for_synology212j
          tag_with_ref: true
          path: build-synology_212

  Syno218p:
    name : Generate for Synology 218+
    runs-on: ubuntu-latest
    if: ${{ github.ref == 'master' }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Build and push Docker images
      uses: docker/build-push-action@v1
      with:
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
          registry: docker.pkg.github.com
          repository: yadoms/docker/build_for_synology218p
          tag_with_ref: true
          path: build-synology_218p
     
          
  Windows_1_VSTools:
    name : Generate for VSTools container
    runs-on: windows-latest
    if: ${{ github.ref == 'master' }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Build VSTools container
      run: docker build -t yadoms/vstools:latest -m 2GB build-windows/1.vstools
    - name: login tp docker
      run: docker login --username ${{ github.actor }} --password ${{ secrets.DOCKERHUB_OAUTH }} 
    - name: Push VSTools container
      run: docker push yadoms/vstools:latest

  Windows_2_Yadoms:
    name : Generate for Windows
    runs-on: windows-latest
    if: ${{ github.ref == 'master' }}
    #needs: Windows_1_VSTools
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Build container
      run: docker build -t yadoms/build_for_windows:latest build-windows/2.build-windows
    - name: login to docker
      run: docker login --username ${{ github.actor }} --password ${{ secrets.DOCKERHUB_OAUTH }}
    - name: Push container
      run: docker push yadoms/build_for_windows
